<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Register Delivery Personnel - Admin</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-yellow-200 to-yellow-50 min-h-screen flex flex-col">
  <header class="bg-white shadow-sm py-4 mb-4">
    <div class="container text-center position-relative">
      <a href="admin-dashboard.html" class="btn btn-outline-warning position-absolute top-0 start-0 m-2">Back to Dashboard</a>
      <h1 class="h4 fw-bold text-yellow-600">Register Delivery Personnel</h1>
    </div>
  </header>
  
  <div class="container flex-grow-1">
    <div class="row">
      <div class="col-md-6">
        <div class="card shadow">
          <div class="card-header bg-primary text-white">
            <h5 class="mb-0">Add New Delivery Personnel</h5>
          </div>
          <div class="card-body">
            <form id="deliveryRegistrationForm">
              <div class="mb-3">
                <label class="form-label">Full Name</label>
                <input type="text" class="form-control" id="deliveryName" required placeholder="e.g., John Doe">
              </div>
              <div class="mb-3">
                <label class="form-label">Email Address</label>
                <input type="email" class="form-control" id="deliveryEmail" required placeholder="e.g., john@example.com">
              </div>
              <div class="mb-3">
                <label class="form-label">Phone Number</label>
                <input type="tel" class="form-control" id="deliveryPhone" required placeholder="e.g., +260 97 123 4567">
              </div>
              <div class="mb-3">
                <label class="form-label">Vehicle Type</label>
                <select class="form-control" id="deliveryVehicle" required>
                  <option value="">Select Vehicle</option>
                  <option value="Motorcycle">Motorcycle</option>
                  <option value="Bicycle">Bicycle</option>
                  <option value="Car">Car</option>
                  <option value="Van">Van</option>
                </select>
              </div>
              <div class="mb-3">
                <label class="form-label">License Plate/ID</label>
                <input type="text" class="form-control" id="deliveryLicense" required placeholder="e.g., ABC 1234">
              </div>
              <div class="mb-3">
                <label class="form-label">Delivery Area</label>
                <input type="text" class="form-control" id="deliveryArea" required placeholder="e.g., Lusaka Central, Woodlands">
              </div>
              <div class="mb-3">
                <label class="form-label">Username (for login)</label>
                <input type="text" class="form-control" id="deliveryUsername" required placeholder="e.g., john_doe">
              </div>
              <div class="mb-3">
                <label class="form-label">Password</label>
                <input type="password" class="form-control" id="deliveryPassword" required placeholder="Minimum 6 characters">
              </div>
              <button type="submit" class="btn btn-primary w-100">Register Delivery Personnel</button>
            </form>
          </div>
        </div>
      </div>
      
      <div class="col-md-6">
        <div class="card shadow">
          <div class="card-header bg-info text-white">
            <h5 class="mb-0">Registered Delivery Personnel</h5>
          </div>
          <div class="card-body">
            <div id="delivery-personnel-list">
              <!-- Delivery personnel will be rendered here -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer class="bg-white text-center py-3 mt-5 shadow-sm">
    <span class="text-muted">&copy; 2024 Food Delivery | Admin Portal</span>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Protect admin access
    if (localStorage.getItem('isAdmin') !== 'true') {
      alert('Admin access only.');
      window.location.href = 'admin-login.html';
    }

    // Load delivery personnel from localStorage
    function loadDeliveryPersonnel() {
      let personnel = JSON.parse(localStorage.getItem('deliveryPersonnel')) || [];
      return personnel;
    }

    function renderDeliveryPersonnel() {
      const personnel = loadDeliveryPersonnel();
      const container = document.getElementById('delivery-personnel-list');
      
      if (personnel.length === 0) {
        container.innerHTML = '<p class="text-center text-muted">No delivery personnel registered yet.</p>';
        return;
      }

      let html = '<div class="row g-2">';
      personnel.forEach(person => {
        const status = getDeliveryPersonStatus(person.id);
        const statusClass = status === 'Available' ? 'badge bg-success' : 'badge bg-warning';
        
        html += `
          <div class="col-12">
            <div class="card">
              <div class="card-body p-3">
                <div class="d-flex justify-content-between align-items-start">
                  <div>
                    <h6 class="mb-1">${person.name}</h6>
                    <small class="text-muted">${person.email}</small><br>
                    <small class="text-muted">${person.phone}</small><br>
                    <small class="text-muted">${person.vehicle} - ${person.license}</small><br>
                    <small class="text-muted">Area: ${person.area}</small>
                  </div>
                  <div class="text-end">
                    <span class="${statusClass}">${status}</span><br>
                    <button class="btn btn-sm btn-danger mt-2" onclick="removeDeliveryPerson(${person.id})">Remove</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        `;
      });
      html += '</div>';
      container.innerHTML = html;
    }

    function getDeliveryPersonStatus(personId) {
      const status = JSON.parse(localStorage.getItem('deliveryPersonnelStatus')) || {};
      return status[personId] || 'Available';
    }

    function registerDeliveryPerson() {
      const name = document.getElementById('deliveryName').value;
      const email = document.getElementById('deliveryEmail').value;
      const phone = document.getElementById('deliveryPhone').value;
      const vehicle = document.getElementById('deliveryVehicle').value;
      const license = document.getElementById('deliveryLicense').value;
      const area = document.getElementById('deliveryArea').value;
      const username = document.getElementById('deliveryUsername').value;
      const password = document.getElementById('deliveryPassword').value;

      if (!name || !email || !phone || !vehicle || !license || !area || !username || !password) {
        alert('Please fill in all fields.');
        return;
      }

      if (password.length < 6) {
        alert('Password must be at least 6 characters long.');
        return;
      }

      const personnel = loadDeliveryPersonnel();
      
      // Check if username already exists
      if (personnel.find(p => p.username === username)) {
        alert('Username already exists. Please choose a different username.');
        return;
      }

      // Check if email already exists
      if (personnel.find(p => p.email === email)) {
        alert('Email already registered. Please use a different email.');
        return;
      }

      const newId = personnel.length > 0 ? Math.max(...personnel.map(p => p.id)) + 1 : 1;
      
      const newPerson = {
        id: newId,
        name: name,
        email: email,
        phone: phone,
        vehicle: vehicle,
        license: license,
        area: area,
        username: username,
        password: password, // In real app, this should be hashed
        registeredAt: new Date().toISOString()
      };

      personnel.push(newPerson);
      localStorage.setItem('deliveryPersonnel', JSON.stringify(personnel));
      
      // Initialize status as Available
      const status = JSON.parse(localStorage.getItem('deliveryPersonnelStatus')) || {};
      status[newId] = 'Available';
      localStorage.setItem('deliveryPersonnelStatus', JSON.stringify(status));
      
      // Clear form
      document.getElementById('deliveryRegistrationForm').reset();
      
      // Refresh display
      renderDeliveryPersonnel();
      
      alert('Delivery personnel registered successfully!');
    }

    function removeDeliveryPerson(id) {
      if (confirm('Are you sure you want to remove this delivery personnel?')) {
        const personnel = loadDeliveryPersonnel();
        const filteredPersonnel = personnel.filter(p => p.id !== id);
        localStorage.setItem('deliveryPersonnel', JSON.stringify(filteredPersonnel));
        
        // Remove status as well
        const status = JSON.parse(localStorage.getItem('deliveryPersonnelStatus')) || {};
        delete status[id];
        localStorage.setItem('deliveryPersonnelStatus', JSON.stringify(status));
        
        renderDeliveryPersonnel();
        alert('Delivery personnel removed successfully!');
      }
    }

    // Event listeners
    document.getElementById('deliveryRegistrationForm').addEventListener('submit', function(e) {
      e.preventDefault();
      registerDeliveryPerson();
    });

    // Initialize page
    renderDeliveryPersonnel();
  </script>
</body>
</html>
