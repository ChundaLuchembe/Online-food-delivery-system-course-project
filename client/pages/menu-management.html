<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Menu Management - Food Delivery</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-yellow-200 to-yellow-50 min-h-screen flex flex-col">
  <header class="bg-white shadow-sm py-4 mb-4">
    <div class="container text-center position-relative">
      <a href="admin-dashboard.html" class="btn btn-outline-warning position-absolute top-0 start-0 m-2">Back to Dashboard</a>
      <h1 class="h4 fw-bold text-yellow-600">Menu Management</h1>
    </div>
  </header>
  
  <div class="container flex-grow-1">
    <div class="row">
      <div class="col-md-8">
        <div class="card shadow mb-4">
          <div class="card-header bg-info text-white">
            <h5 class="mb-0">Current Menu Items</h5>
          </div>
          <div class="card-body">
            <div id="menu-items-list">
              <!-- Menu items will be rendered here -->
            </div>
          </div>
        </div>
      </div>
      
      <div class="col-md-4">
        <div class="card shadow">
          <div class="card-header bg-success text-white">
            <h5 class="mb-0">Add New Menu Item</h5>
          </div>
          <div class="card-body">
            <form id="addMenuItemForm">
              <div class="mb-3">
                <label class="form-label">Item Name</label>
                <input type="text" class="form-control" id="itemName" required placeholder="e.g., Grilled Chicken">
              </div>
              <div class="mb-3">
                <label class="form-label">Price (ZMW)</label>
                <input type="number" class="form-control" id="itemPrice" required placeholder="e.g., 60" min="1">
              </div>
              <div class="mb-3">
                <label class="form-label">Description</label>
                <textarea class="form-control" id="itemDesc" rows="2" required placeholder="Brief description of the item"></textarea>
              </div>
              <div class="mb-3">
                <label class="form-label">Image Path</label>
                <input type="text" class="form-control" id="itemImage" required placeholder="../images/filename.jpeg">
                <small class="text-muted">Use relative path from pages folder</small>
              </div>
              <button type="submit" class="btn btn-success w-100">Add Menu Item</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Menu Item Modal -->
  <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="editModalLabel">Edit Menu Item</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="editMenuItemForm">
            <input type="hidden" id="editItemId">
            <div class="mb-3">
              <label class="form-label">Item Name</label>
              <input type="text" class="form-control" id="editItemName" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Price (ZMW)</label>
              <input type="number" class="form-control" id="editItemPrice" required min="1">
            </div>
            <div class="mb-3">
              <label class="form-label">Description</label>
              <textarea class="form-control" id="editItemDesc" rows="2" required></textarea>
            </div>
            <div class="mb-3">
              <label class="form-label">Image Path</label>
              <input type="text" class="form-control" id="editItemImage" required>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" onclick="updateMenuItem()">Update Item</button>
        </div>
      </div>
    </div>
  </div>

  <footer class="bg-white text-center py-3 mt-5 shadow-sm">
    <span class="text-muted">&copy; 2024 Food Delivery | Admin Portal</span>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Protect admin access
    if (localStorage.getItem('isAdmin') !== 'true') {
      alert('Admin access only.');
      window.location.href = 'admin-login.html';
    }

    // Load menu items from localStorage or use default
    function loadMenuItems() {
      let menuItems = JSON.parse(localStorage.getItem('menuItems'));
      if (!menuItems) {
        // Default menu items
        menuItems = [
          {
            id: 1,
            name: 'Grilled Chicken',
            price: 60,
            image: '../images/A close-up view of juicy, golden-seared chickenâ€¦.jpeg',
            desc: 'Juicy golden-seared chicken with herbs.'
          },
          {
            id: 2,
            name: 'Veggie Pizza',
            price: 90,
            image: '../images/pizza.jpeg',
            desc: 'Loaded with fresh vegetables.'
          },
          {
            id: 3,
            name: 'Grilled Fish',
            price: 85,
            image: '../images/Grill Tilapia (African Style) - Immaculate Bites.jpeg',
            desc: 'Perfectly grilled fish with lemon and herbs.'
          },
          {
            id: 4,
            name: 'Tandoori Chicken',
            price: 80,
            image: '../images/tondorochiken.jpeg',
            desc: 'Spicy tandoori chicken with salad.'
          },
          {
            id: 5,
            name: 'Pasta Alfredo',
            price: 70,
            image: '../images/pastaalfredo.jpeg',
            desc: 'Creamy Alfredo pasta with mushrooms.'
          },
          {
            id: 6,
            name: 'Samosa Plate',
            price: 30,
            image: '../images/samosas.jpeg',
            desc: 'Crispy samosas with chutney.'
          },
          {
            id: 7,
            name: 'Fruit Smoothie',
            price: 25,
            image: '../images/Fruitsmoothie.jpeg',
            desc: 'Refreshing mixed fruit smoothie.'
          },
          {
            id: 8,
            name: 'Chocolate Cake',
            price: 40,
            image: '../images/cake.jpeg',
            desc: 'Rich chocolate cake slice.'
          }
        ];
        localStorage.setItem('menuItems', JSON.stringify(menuItems));
      }
      return menuItems;
    }

    function renderMenuItems() {
      const menuItems = loadMenuItems();
      const container = document.getElementById('menu-items-list');
      
      if (menuItems.length === 0) {
        container.innerHTML = '<p class="text-center text-muted">No menu items found. Add some items to get started!</p>';
        return;
      }

      let html = '<div class="row g-3">';
      menuItems.forEach(item => {
        html += `
          <div class="col-md-6 col-lg-4">
            <div class="card h-100">
              <img src="${item.image}" class="card-img-top" alt="${item.name}" style="height: 200px; object-fit: cover;">
              <div class="card-body d-flex flex-column">
                <h6 class="card-title">${item.name}</h6>
                <p class="card-text text-muted small">${item.desc}</p>
                <p class="card-text fw-bold text-warning">ZMW ${item.price}</p>
                <div class="mt-auto">
                  <button class="btn btn-sm btn-primary me-1" onclick="editMenuItem(${item.id})">Edit</button>
                  <button class="btn btn-sm btn-danger" onclick="deleteMenuItem(${item.id})">Delete</button>
                </div>
              </div>
            </div>
          </div>
        `;
      });
      html += '</div>';
      container.innerHTML = html;
    }

    function addMenuItem() {
      const name = document.getElementById('itemName').value;
      const price = parseFloat(document.getElementById('itemPrice').value);
      const desc = document.getElementById('itemDesc').value;
      const image = document.getElementById('itemImage').value;

      if (!name || !price || !desc || !image) {
        alert('Please fill in all fields.');
        return;
      }

      const menuItems = loadMenuItems();
      const newId = Math.max(...menuItems.map(item => item.id)) + 1;
      
      const newItem = {
        id: newId,
        name: name,
        price: price,
        desc: desc,
        image: image
      };

      menuItems.push(newItem);
      localStorage.setItem('menuItems', JSON.stringify(menuItems));
      
      // Clear form
      document.getElementById('addMenuItemForm').reset();
      
      // Refresh display
      renderMenuItems();
      
      alert('Menu item added successfully!');
    }

    function editMenuItem(id) {
      const menuItems = loadMenuItems();
      const item = menuItems.find(i => i.id === id);
      
      if (item) {
        document.getElementById('editItemId').value = item.id;
        document.getElementById('editItemName').value = item.name;
        document.getElementById('editItemPrice').value = item.price;
        document.getElementById('editItemDesc').value = item.desc;
        document.getElementById('editItemImage').value = item.image;
        
        new bootstrap.Modal(document.getElementById('editModal')).show();
      }
    }

    function updateMenuItem() {
      const id = parseInt(document.getElementById('editItemId').value);
      const name = document.getElementById('editItemName').value;
      const price = parseFloat(document.getElementById('editItemPrice').value);
      const desc = document.getElementById('editItemDesc').value;
      const image = document.getElementById('editItemImage').value;

      if (!name || !price || !desc || !image) {
        alert('Please fill in all fields.');
        return;
      }

      const menuItems = loadMenuItems();
      const itemIndex = menuItems.findIndex(i => i.id === id);
      
      if (itemIndex !== -1) {
        menuItems[itemIndex] = { id, name, price, desc, image };
        localStorage.setItem('menuItems', JSON.stringify(menuItems));
        
        bootstrap.Modal.getInstance(document.getElementById('editModal')).hide();
        renderMenuItems();
        
        alert('Menu item updated successfully!');
      }
    }

    function deleteMenuItem(id) {
      if (confirm('Are you sure you want to delete this menu item?')) {
        const menuItems = loadMenuItems();
        const filteredItems = menuItems.filter(item => item.id !== id);
        localStorage.setItem('menuItems', JSON.stringify(filteredItems));
        
        renderMenuItems();
        alert('Menu item deleted successfully!');
      }
    }

    // Event listeners
    document.getElementById('addMenuItemForm').addEventListener('submit', function(e) {
      e.preventDefault();
      addMenuItem();
    });

    // Initialize page
    renderMenuItems();
  </script>
</body>
</html>
